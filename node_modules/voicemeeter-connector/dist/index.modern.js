import e from"ffi-napi";import t from"ref-array-napi";import r from"winreg";const i=t("char"),o=t("long"),n=t("float");let s,a;class c{constructor(){this.isInitialised=!1,this.isConnected=!1,this.outputDevices=[],this.inputDevices=[],this.version="",this.type=void 0,this.eventPool=[],this.connect=()=>{if(!this.isInitialised)throw new Error("Await the initialisation before connect");if(!this.isConnected){if(0===s.VBVMR_Login())return this.isConnected=!0,this.type=this.getVoicemeeterType(),this.version=this.getVoicemeeterVersion(),void setInterval(this.checkPropertyChange,10);throw this.isConnected=!1,new Error("Connection failed")}},this.disconnect=()=>{if(!this.isConnected)throw new Error("Not connected ");try{if(0===s.VBVMR_Logout())return void(this.isConnected=!1);throw new Error("Disconnect failed")}catch(e){throw new Error("Disconnect failed")}},this.updateDeviceList=()=>{if(!this.isConnected)throw new Error("Not connected ");this.outputDevices=[],this.inputDevices=[];const e=s.VBVMR_Output_GetDeviceNumber();for(let t=0;t<e;t++){const e=new i(256),r=new i(256),n=new o(1);s.VBVMR_Output_GetDeviceDescA(t,n,r,e),this.outputDevices.push({name:String.fromCharCode(...r.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode(...e.toArray()).replace(/\u0000+$/g,""),type:n[0]})}const t=s.VBVMR_Input_GetDeviceNumber();for(let e=0;e<t;e++){const t=new i(256),r=new i(256),n=new o(1);s.VBVMR_Input_GetDeviceDescA(e,n,r,t),this.inputDevices.push({name:String.fromCharCode(...r.toArray()).replace(/\u0000+$/g,""),hardwareId:String.fromCharCode(...t.toArray()).replace(/\u0000+$/g,""),type:n[0]})}},this.isParametersDirty=()=>s.VBVMR_IsParametersDirty(),this.getBusParameter=(e,t)=>this.getParameter("Bus",e,t),this.getStripParameter=(e,t)=>this.getParameter("Strip",e,t),this.setStripParameter=(e,t,r)=>this.setParameter("Strip",e,t,r),this.setBusParameter=(e,t,r)=>this.setParameter("Bus",e,t,r),this.attachChangeEvent=e=>{this.eventPool.push(e)},this.setOption=e=>{const t=Buffer.alloc(e.length+1);return t.fill(0).write(e),s.VBVMR_SetParameters(t),new Promise(e=>setTimeout(e,200))},this.checkPropertyChange=()=>{1===this.isParametersDirty()&&this.eventPool.forEach(e=>{e()})},this.getVoicemeeterType=()=>{const e=new o(1);if(0!==s.VBVMR_GetVoicemeeterType(e))throw new Error("running failed");switch(e[0]){case 1:return"voicemeeter";case 2:return"voicemeeterBanana";case 3:return"voicemeeterPotato";default:throw new Error("Voicemeeter seems not to be installed")}},this.getVoicemeeterVersion=()=>{const e=new o(1);if(0!==s.VBVMR_GetVoicemeeterVersion(e))throw new Error("running failed");return e},this.getParameter=(e,t,r)=>{const o=`${e}[${t}].${r}`;if(!this.isConnected)throw new Error("Not correct connected ");const a=Buffer.alloc(o.length+1);a.write(o);let c=null;return["Label","FadeTo","FadeBy","AppGain","AppMute","device.name"].indexOf(r)>-1?(c=new i(512),s.VBVMR_GetParameterStringA(a,c),String.fromCharCode.apply(null,c).split("").filter(e=>"\0"!==e).join("")):(c=new n(1),s.VBVMR_GetParameterFloat(a,c),c[0])},this.setParameter=(e,t,r,i)=>{if(!this.isConnected)throw new Error("Not connected ");return this.setOption(`${e}[${t}].${r}=${i};`)}}static async init(){const t=await(async()=>{const e=new r({hive:r.HKLM,key:"\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\VB:Voicemeeter {17359A74-1236-5467}"});return new Promise(t=>{e.values((e,r)=>{if(e)throw new Error(e);const i=r.find(e=>"UninstallString"===e.name).value,o=i.lastIndexOf("\\");t(i.slice(0,o))})})})();return new Promise(r=>{a||(a=new c),s=e.Library(`${t}/VoicemeeterRemote64.dll`,{VBVMR_Login:["long",[]],VBVMR_Logout:["long",[]],VBVMR_RunVoicemeeter:["long",["long"]],VBVMR_IsParametersDirty:["long",[]],VBVMR_GetParameterFloat:["long",[i,n]],VBVMR_GetParameterStringA:["long",[i,i]],VBVMR_SetParameters:["long",[i]],VBVMR_Output_GetDeviceNumber:["long",[]],VBVMR_Output_GetDeviceDescA:["long",["long",o,i,i]],VBVMR_Input_GetDeviceNumber:["long",[]],VBVMR_Input_GetDeviceDescA:["long",["long",o,i,i]],VBVMR_GetVoicemeeterType:["long",[o]],VBVMR_GetVoicemeeterVersion:["long",[o]]}),a.isInitialised=!0,r(a)})}get $outputDevices(){return this.outputDevices}get $inputDevices(){return this.inputDevices}get $version(){return this.version}get $type(){return this.type}}var u,h;!function(e){e.Mono="Mono",e.Mute="Mute",e.Solo="Solo",e.MC="MC",e.Gain="Gain",e.Pan_x="Pan_x",e.Pan_y="Pan_y",e.Color_x="Color_x",e.Color_y="Color_y",e.fx_x="fx_x",e.fx_y="fx_y",e.Audibility="Audibility",e.Comp="Comp",e.Gate="Gate",e.EqGain1="EqGain1",e.EqGain2="EqGain2",e.EqGain3="EqGain3",e.Label="Label",e.A1="A1",e.A2="A2",e.A3="A3",e.A4="A4",e.A5="A5",e.B1="B1",e.B2="B2",e.B3="B3",e.FadeTo="FadeTo"}(u||(u={})),function(e){e.Mono="Mono",e.Mute="Mute",e.EQ="EQ.on",e.Gain="Gain",e.NormalMode="mode.normal",e.AmixMode="mode.Amix",e.BmixMode="mode.Bmix",e.RepeatMode="mode.Repeat",e.CompositeMode="mode.Composite",e.FadeTo="FadeTo"}(h||(h={}));var l={__proto__:null,InterfaceTypes:{strip:0,bus:1},get StripProperties(){return u},get BusProperties(){return h}},m={__proto__:null};const{BusProperties:p,InterfaceTypes:V,StripProperties:d}=l;export{p as BusProperties,V as InterfaceTypes,d as StripProperties,c as Voicemeeter,m as types};
//# sourceMappingURL=index.modern.js.map
